<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>控制器转场动画 | kakadee</title>
    <meta name="description" content="种一棵树最好的时间是十年前，其次就是现在。">
    
    
    <link rel="preload" href="/kakadeeBlog/assets/css/0.styles.5f1205b4.css" as="style"><link rel="preload" href="/kakadeeBlog/assets/js/app.8bc012c0.js" as="script"><link rel="preload" href="/kakadeeBlog/assets/js/2.312bb894.js" as="script"><link rel="preload" href="/kakadeeBlog/assets/js/7.b00e30c5.js" as="script"><link rel="prefetch" href="/kakadeeBlog/assets/js/10.ff4e560c.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/11.5e7d1227.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/12.8737b8e5.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/13.3fa76b06.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/14.3d8eb73c.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/15.360c988d.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/16.215897df.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/17.5b1c033f.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/18.6dd2fa4f.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/19.18c4a796.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/3.119f8bcd.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/4.f7c0e7b7.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/5.4aebb849.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/6.f4cc0c84.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/8.a94648fe.js"><link rel="prefetch" href="/kakadeeBlog/assets/js/9.a6206a54.js">
    <link rel="stylesheet" href="/kakadeeBlog/assets/css/0.styles.5f1205b4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kakadeeBlog/" class="home-link router-link-active"><!----> <span class="site-name">kakadee</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kakadeeBlog/iOS/" class="nav-link router-link-active">iOS</a></div><div class="nav-item"><a href="/kakadeeBlog/Project/" class="nav-link">Project</a></div><div class="nav-item"><a href="/kakadeeBlog/Resume/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/kakadeeBlog/Essay/" class="nav-link">Essay</a></div> <a href="https://github.com/kakadee/kakadeeBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kakadeeBlog/iOS/" class="nav-link router-link-active">iOS</a></div><div class="nav-item"><a href="/kakadeeBlog/Project/" class="nav-link">Project</a></div><div class="nav-item"><a href="/kakadeeBlog/Resume/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/kakadeeBlog/Essay/" class="nav-link">Essay</a></div> <a href="https://github.com/kakadee/kakadeeBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/kakadeeBlog/iOS/" class="sidebar-link">iOS</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>iOS基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Core Animation</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kakadeeBlog/iOS/CoreAnimation/CoreAnimation路径规划.html" class="sidebar-link">Core Animation路径规划</a></li><li><a href="/kakadeeBlog/iOS/CoreAnimation/0-视图转场动画.html" class="sidebar-link">视图转场动画</a></li><li><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html" class="active sidebar-link">控制器转场动画</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html#控制器的显示方式" class="sidebar-link">控制器的显示方式</a></li><li class="sidebar-sub-header"><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html#哪些转场可以自定义" class="sidebar-link">哪些转场可以自定义</a></li><li class="sidebar-sub-header"><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html#非交互转场" class="sidebar-link">非交互转场</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html#_1-设置转场代理" class="sidebar-link">1. 设置转场代理</a></li><li class="sidebar-sub-header"><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html#_2-指定动画控制器" class="sidebar-link">2. 指定动画控制器</a></li></ul></li><li class="sidebar-sub-header"><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html#交互转场" class="sidebar-link">交互转场</a></li><li class="sidebar-sub-header"><a href="/kakadeeBlog/iOS/CoreAnimation/1-控制器转场动画.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/kakadeeBlog/iOS/CoreAnimation/CATransaction.html" class="sidebar-link">CATransaction</a></li><li><a href="/kakadeeBlog/iOS/CoreAnimation/CAAction.html" class="sidebar-link">CAAction</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="控制器转场动画"><a href="#控制器转场动画" aria-hidden="true" class="header-anchor">#</a> 控制器转场动画</h1> <p>我们应用实践中用到的转场动画大多数是<strong>控制器之间</strong>的转场动画。</p> <p>然而转场动画，其实可以分成成两层意思，“转场” 和 “动画” 。</p> <p>本篇的重点也集中在控制器的 <strong>转场</strong> 上面。</p> <p>在说什么是控制器的转场之前，我们得先了解下控制器的显示。</p> <h2 id="控制器的显示方式"><a href="#控制器的显示方式" aria-hidden="true" class="header-anchor">#</a> 控制器的显示方式</h2> <p>我们知道视图控制器中的视图显示在屏幕上有两种方式：</p> <p><strong>1. 内嵌在容器控制器中。</strong></p> <p>比如 UINavigationController，UITabBarController, UISplitController，这些是常见的容器控制器。Content Controller 内嵌在 Container Controller 中显示。</p> <p><strong>2. 由另一个控制器弹出显示。</strong></p> <p>这种方式通常被称为模态(Modal)显示。</p> <p>那么到底什么是转场呢？</p> <p>在 NavigationController 里 push 或 pop 一个 View Controller，在 TabBarController 中切换到其他 View Controller，以 Modal 方式显示另外一个 View Controller，这些都是叫转场（View Controller Transition）。</p> <div class="tip custom-block"><p>在 iOS 7 之前，我们只能使用系统提供的转场效果，iOS 7 之后，苹果开放了相关 API 允许我们对转场效果进行自定义的控制。</p></div> <h2 id="哪些转场可以自定义"><a href="#哪些转场可以自定义" aria-hidden="true" class="header-anchor">#</a> 哪些转场可以自定义</h2> <p>根据 <a href="https://developer.apple.com/videos/play/wwdc2013/218/" target="_blank" rel="noopener noreferrer">WWDC2013 Session 218<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的介绍，<strong>Which transitions can be customized? （什么样的transition能够自定义）</strong></p> <ul><li>Presentations and dismissals （模态转场，仅限于modalPresentationStyle属性为 UIModalPresentationFullScreen 或 UIModalPresentationCustom 这两种模式）</li> <li>UITabBarController （切换tab)</li> <li>UINavigationController (push or pop)</li> <li>UICollectionViewController layout-to-layout transitions</li></ul> <p>苹果官方借助代理实现自定义转场，理论上，只要我们灵活应用并遵循代理，可以实现任意自定义控制器的转场。</p> <p>以 present 一个 VC 为例。当一个 presented view controller 的 transitioningDelegate 不为空的时候， UIKit 会使用你提供的自定义动画去展示控制器.
当要准备展示的时候，UIKit 会调用 <code>animationControllerForPresentedController:presentingController:sourceController:</code> 方法，去检索自定义的动画对象。如果所有的对象都准备好了，UIKit会执行以下动作：</p> <ol><li><p>UIKit 调用 <code>interactionControllerForPresentation:</code> 代理方法去查看是否手势动画对象是存在的，如果是nil,UIKit执行不包含手势交互的动画。</p></li> <li><p>UIKit 调用 动画对象的<code>transitionDuration:</code> 方法来获取动画执行时间。</p></li> <li><p>UIKit 选择合适的方法去开始执行动画：</p> <ul><li>对没有手势交互的动画，UIKit 调用 <code>animateTransition:</code> 方法。</li> <li>对于手势交互动画，UIKit 调用 <code>startInteractiveTransition:</code> 方法。</li></ul></li> <li><p>UIKit 等待动画对象执行完，调用 <code>completeTransition:</code> 方法。
当动画对象执行完，UIKit就知道应该调用 <code>presentViewController:animated:completion:</code> 里的 completion 了。 接着，会调用 动画对象自己的 <code>animationEnded:</code> 方法。</p></li></ol> <p><strong>转场动画的本质</strong>: 下一场景(子 VC)的视图替换当前场景(子 VC)的视图以及相应的控制器(子 VC)的替换，表现为当前视图消失和下一视图出现。</p> <p>对于<font color="red">非交互式动画</font> 我们只需要实现<font color="red">转场代理协议</font>和<font color="red">动画控制器协议</font>即可。</p> <p>对于<font color="red">交互式动画</font>我们还需要实现<font color="red">交互控制器协议</font> 。</p> <h2 id="非交互转场"><a href="#非交互转场" aria-hidden="true" class="header-anchor">#</a> 非交互转场</h2> <p>在转场动画的过程中，不涉及到用户手势交互的，我们称为非交互转场。因为不涉及到手势的逻辑处理，非交互转场肯定是更简单一下。下图是设置非交互转场的几个步骤，非常简单。</p> <p><img src="https://raw.githubusercontent.com/kakadee/myMarkDownPic/master/img/20190918105029.png" alt="非交互转场过程"></p> <p>下面分几个重要步骤说明如何完成一个非交互转场：</p> <h3 id="_1-设置转场代理"><a href="#_1-设置转场代理" aria-hidden="true" class="header-anchor">#</a> 1. 设置转场代理</h3> <p>自定义转场的第一步便是提供转场代理，告诉系统使用我们提供的代理而不是系统的默认代理来执行转场。根据控制器的不同，苹果给我们提供了三种转场代理：</p> <h4 id="uinavigationcontrollerdelegate"><a href="#uinavigationcontrollerdelegate" aria-hidden="true" class="header-anchor">#</a> UINavigationControllerDelegate</h4> <p>UINavigationController 的 delegate 属性遵守该协议。</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">/*返回已经实现的`动画控制器`，如果返回nil则使用系统默认的动画效果*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>navigationController<span class="token punctuation">:</span><span class="token punctuation">(</span>UINavigationController <span class="token operator">*</span><span class="token punctuation">)</span>navigationController 
animationControllerForOperation<span class="token punctuation">:</span><span class="token punctuation">(</span>UINavigationControllerOperation<span class="token punctuation">)</span>operation  
fromViewController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>fromVC 
toViewController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>toVC  <span class="token function">NS_AVAILABLE_IOS</span><span class="token punctuation">(</span><span class="token number">7</span>_0<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*返回已经实现的`交互控制器`，如果返回nil则不支持手势交互*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerInteractiveTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>navigationController<span class="token punctuation">:</span><span class="token punctuation">(</span>UINavigationController <span class="token operator">*</span><span class="token punctuation">)</span>navigationController 
interactionControllerForAnimationController<span class="token punctuation">:</span><span class="token punctuation">(</span>id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span> animationController <span class="token function">NS_AVAILABLE_IOS</span><span class="token punctuation">(</span><span class="token number">7</span>_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="uitabbarcontrollerdelegate"><a href="#uitabbarcontrollerdelegate" aria-hidden="true" class="header-anchor">#</a> UITabBarControllerDelegate</h4> <p>同样作为容器控制器，UITabBarController 的转场代理和 UINavigationController 类似，通过类似的方法提供动画控制器，不过UINavigationControllerDelegate的代理方法里提供了操作类型，但UITabBarControllerDelegate的代理方法没有提供滑动的方向信息，需要我们来获取滑动的方向。</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">/*同理返回已经实现的`动画控制器`,返回nil是默认效果*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>tabBarController<span class="token punctuation">:</span><span class="token punctuation">(</span>UITabBarController <span class="token operator">*</span><span class="token punctuation">)</span>tabBarController animationControllerForTransitionFromViewController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>fromVC toViewController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>toVC<span class="token punctuation">;</span>

<span class="token comment">/*返回已经实现的`交互控制器`,返回nil则不支持用户交互*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerInteractiveTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>tabBarController<span class="token punctuation">:</span><span class="token punctuation">(</span>UITabBarController <span class="token operator">*</span><span class="token punctuation">)</span>tabBarController interactionControllerForAnimationController<span class="token punctuation">:</span> <span class="token punctuation">(</span>id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>animationController <span class="token function">NS_AVAILABLE_IOS</span><span class="token punctuation">(</span><span class="token number">7</span>_0<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="uiviewcontrollertransitioningdelegate"><a href="#uiviewcontrollertransitioningdelegate" aria-hidden="true" class="header-anchor">#</a> UIViewControllerTransitioningDelegate</h4> <p>Modal 转场的代理协议UIViewControllerTransitioningDelegate是 iOS 7 新增的，其为 presentation 和 dismissal 转场分别提供了动画控制器。</p> <p>UIPresentationController只在 iOS 8中可用，通过available关键字可以解决 API 的版本差异。</p> <p>Modal 转场的代理由 presentedVC 的transitioningDelegate属性来提供，这与前两种容器控制器的转场不一样,另外，需要将 presentedVC 的modalPresentationStyle属性设置为.Custom或.FullScreen，只有这两种模式下才支持自定义转场，该属性默认值为.FullScreen。当与 UIPresentationController 配合时该属性必须为.Custom。</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">/*present时调用，返回已经实现的`动画控制器`*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>animationControllerForPresentedController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>presented presentingController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>presenting sourceController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>source<span class="token punctuation">;</span>

<span class="token comment">/*dissmiss时调用，返回已经实现的`动画控制器`*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>animationControllerForDismissedController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>dismissed<span class="token punctuation">;</span>

<span class="token comment">/*交互动画present时调用，返回已经实现的`交互控制器`*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerInteractiveTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>interactionControllerForPresentation<span class="token punctuation">:</span><span class="token punctuation">(</span>id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>animator<span class="token punctuation">;</span>

<span class="token comment">/*交互动画dissmiss时调用，返回已经实现的`交互控制器`*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerInteractiveTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>interactionControllerForDismissal<span class="token punctuation">:</span><span class="token punctuation">(</span>id <span class="token operator">&lt;</span>UIViewControllerAnimatedTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>animator<span class="token punctuation">;</span>

<span class="token comment">/*ios8新增的协议*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable UIPresentationController <span class="token operator">*</span><span class="token punctuation">)</span>presentationControllerForPresentedViewController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>presented presentingViewController<span class="token punctuation">:</span><span class="token punctuation">(</span>nullable UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>presenting sourceViewController<span class="token punctuation">:</span><span class="token punctuation">(</span>UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>source <span class="token function">NS_AVAILABLE_IOS</span><span class="token punctuation">(</span><span class="token number">8</span>_0<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2-指定动画控制器"><a href="#_2-指定动画控制器" aria-hidden="true" class="header-anchor">#</a> 2. 指定动画控制器</h3> <p>动画控制器的职责是添加视图以及执行动画。</p> <p>我们可以看到，转场代理返回的动画控制器，都遵守UIViewControllerAnimatedTransitioning协议，该协议必须实现的方法有以下两个：</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">/*返回动画执行时间，一般0.5s就足够了*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSTimeInterval<span class="token punctuation">)</span>transitionDuration<span class="token punctuation">:</span><span class="token punctuation">(</span>nullable id <span class="token operator">&lt;</span>UIViewControllerContextTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext<span class="token punctuation">;</span>

<span class="token comment">/*核心方法，做一些动画相关的操作*/</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>animateTransition<span class="token punctuation">:</span><span class="token punctuation">(</span>id <span class="token operator">&lt;</span>UIViewControllerContextTransitioning<span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们可以看到，在动画控制器所遵守的协议中，有一个<code>transitionContext</code>,它是UIKit在转场开始前生成的环境上下文，主要提供动画控制器所需要的信息：</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">/*获取容器视图，转场发生的地方*/</span>
UIView <span class="token operator">*</span>containerView <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext containerView<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/*获取参与转场的视图控制器*/</span>
UIViewController <span class="token operator">*</span>fromVC <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewControllerForKey<span class="token punctuation">:</span>UITransitionContextFromViewControllerKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
UIViewController <span class="token operator">*</span>toVC <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewControllerForKey<span class="token punctuation">:</span>UITransitionContextToViewControllerKey<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/*获取参与参与转场的视图View*/</span>
UIView <span class="token operator">*</span>fromView<span class="token punctuation">;</span>
UIView <span class="token operator">*</span>toView<span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>transitionContext respondsToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>viewForKey<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//iOS8新增的方法</span>
      fromView <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewForKey<span class="token punctuation">:</span>UITransitionContextFromViewKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
      toView <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewForKey<span class="token punctuation">:</span>UITransitionContextToViewKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token comment">//iOS8之前的方法</span>
      fromView <span class="token operator">=</span> fromVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
      toView <span class="token operator">=</span> toVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="danger custom-block"><p class="custom-block-title">重要</p> <p>在动画控制器的动画执行完毕的时候，必须执行<br>
[transitionContext completeTransition:YES];<br>
向context报告VC切换完成，是否成功。系统在接收到这个消息后，将对VC状态进行维护。</p></div> <h2 id="交互转场"><a href="#交互转场" aria-hidden="true" class="header-anchor">#</a> 交互转场</h2> <p>在非交互转场的基础上将之交互化需要两个条件：</p> <ol><li><p>由转场代理提供交互控制器，这是一个遵守 <code>&lt;UIViewControllerInteractiveTransitioning&gt;</code> 协议的对象，不过系统已经打包好了现成的类<code>UIPercentDrivenInteractiveTransition</code>供我们使用。我们不需要做任何配置，仅仅在转场代理的相应方法中提供一个该类实例便能工作。另外交互控制器必须有动画控制器才能工作。</p></li> <li><p>交互控制器还需要交互手段的配合，最常见的是使用手势，或是其他事件，来驱动整个转场进程。</p></li></ol> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ol><li><p><a href="https://developer.apple.com/library/archive/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html#//apple_ref/doc/uid/TP40007457-CH16-SW1" target="_blank" rel="noopener noreferrer">Customizing the Transition Animations<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/alanwangmodify/WXSTransition" target="_blank" rel="noopener noreferrer">WXSTransition<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/ColinEberhardt/VCTransitionsLibrary" target="_blank" rel="noopener noreferrer">VCTransitionsLibrary<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/seedante/iOS-Note/wiki/ViewController-Transition" target="_blank" rel="noopener noreferrer">iOS 视图控制器转场详解（seedante）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.apple.com/library/archive/featuredarticles/ViewControllerPGforiPhoneOS/" target="_blank" rel="noopener noreferrer">View Controller Programming Guide for iOS
<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.apple.com/videos/play/wwdc2013/218/" target="_blank" rel="noopener noreferrer">Custom Transitions Using View Controllers
<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">11/12/2019, 2:55:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kakadeeBlog/iOS/CoreAnimation/0-视图转场动画.html" class="prev">
          视图转场动画
        </a></span> <span class="next"><a href="/kakadeeBlog/iOS/CoreAnimation/CATransaction.html">
          CATransaction
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/kakadeeBlog/assets/js/app.8bc012c0.js" defer></script><script src="/kakadeeBlog/assets/js/2.312bb894.js" defer></script><script src="/kakadeeBlog/assets/js/7.b00e30c5.js" defer></script>
  </body>
</html>
