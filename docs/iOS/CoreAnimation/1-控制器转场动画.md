# æ§åˆ¶å™¨è½¬åœºåŠ¨ç”»

æˆ‘ä»¬åº”ç”¨å®è·µä¸­ç”¨åˆ°çš„è½¬åœºåŠ¨ç”»å¤§å¤šæ•°æ˜¯**æ§åˆ¶å™¨ä¹‹é—´**çš„è½¬åœºåŠ¨ç”»ã€‚

ç„¶è€Œè½¬åœºåŠ¨ç”»ï¼Œå…¶å®å¯ä»¥åˆ†æˆæˆä¸¤å±‚æ„æ€ï¼Œâ€œè½¬åœºâ€ å’Œ â€œåŠ¨ç”»â€ ã€‚

æœ¬ç¯‡çš„é‡ç‚¹ä¹Ÿé›†ä¸­åœ¨æ§åˆ¶å™¨çš„ **è½¬åœº** ä¸Šé¢ã€‚

åœ¨è¯´ä»€ä¹ˆæ˜¯æ§åˆ¶å™¨çš„è½¬åœºä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆäº†è§£ä¸‹æ§åˆ¶å™¨çš„æ˜¾ç¤ºã€‚

## æ§åˆ¶å™¨çš„æ˜¾ç¤ºæ–¹å¼

æˆ‘ä»¬çŸ¥é“è§†å›¾æ§åˆ¶å™¨ä¸­çš„è§†å›¾æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæœ‰ä¸¤ç§æ–¹å¼ï¼š

**1. å†…åµŒåœ¨å®¹å™¨æ§åˆ¶å™¨ä¸­ã€‚**

æ¯”å¦‚ UINavigationControllerï¼ŒUITabBarController, UISplitControllerï¼Œè¿™äº›æ˜¯å¸¸è§çš„å®¹å™¨æ§åˆ¶å™¨ã€‚Content Controller å†…åµŒåœ¨ Container Controller ä¸­æ˜¾ç¤ºã€‚

**2. ç”±å¦ä¸€ä¸ªæ§åˆ¶å™¨å¼¹å‡ºæ˜¾ç¤ºã€‚**

è¿™ç§æ–¹å¼é€šå¸¸è¢«ç§°ä¸ºæ¨¡æ€(Modal)æ˜¾ç¤ºã€‚

é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯è½¬åœºå‘¢ï¼Ÿ

åœ¨ NavigationController é‡Œ push æˆ– pop ä¸€ä¸ª View Controllerï¼Œåœ¨ TabBarController ä¸­åˆ‡æ¢åˆ°å…¶ä»– View Controllerï¼Œä»¥ Modal æ–¹å¼æ˜¾ç¤ºå¦å¤–ä¸€ä¸ª View Controllerï¼Œè¿™äº›éƒ½æ˜¯å«è½¬åœºï¼ˆView Controller Transitionï¼‰ã€‚

::: tip
åœ¨ iOS 7 ä¹‹å‰ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨ç³»ç»Ÿæä¾›çš„è½¬åœºæ•ˆæœï¼ŒiOS 7 ä¹‹åï¼Œè‹¹æœå¼€æ”¾äº†ç›¸å…³ API å…è®¸æˆ‘ä»¬å¯¹è½¬åœºæ•ˆæœè¿›è¡Œè‡ªå®šä¹‰çš„æ§åˆ¶ã€‚
:::

## å“ªäº›è½¬åœºå¯ä»¥è‡ªå®šä¹‰

æ ¹æ® [WWDC2013 Session 218](https://developer.apple.com/videos/play/wwdc2013/218/) çš„ä»‹ç»ï¼Œ**Which transitions can be customized? ï¼ˆä»€ä¹ˆæ ·çš„transitionèƒ½å¤Ÿè‡ªå®šä¹‰ï¼‰**

* Presentations and dismissals ï¼ˆæ¨¡æ€è½¬åœºï¼Œä»…é™äºmodalPresentationStyleå±æ€§ä¸º UIModalPresentationFullScreen æˆ– UIModalPresentationCustom è¿™ä¸¤ç§æ¨¡å¼ï¼‰
* UITabBarController ï¼ˆåˆ‡æ¢tab)
* UINavigationController (push or pop)
* UICollectionViewController layout-to-layout transitions

è‹¹æœå®˜æ–¹å€ŸåŠ©ä»£ç†å®ç°è‡ªå®šä¹‰è½¬åœºï¼Œç†è®ºä¸Šï¼Œåªè¦æˆ‘ä»¬çµæ´»åº”ç”¨å¹¶éµå¾ªä»£ç†ï¼Œå¯ä»¥å®ç°ä»»æ„è‡ªå®šä¹‰æ§åˆ¶å™¨çš„è½¬åœºã€‚

## è½¬åœºåè®®

**è½¬åœºåŠ¨ç”»çš„æœ¬è´¨**: ä¸‹ä¸€åœºæ™¯(å­ VC)çš„è§†å›¾æ›¿æ¢å½“å‰åœºæ™¯(å­ VC)çš„è§†å›¾ä»¥åŠç›¸åº”çš„æ§åˆ¶å™¨(å­ VC)çš„æ›¿æ¢ï¼Œè¡¨ç°ä¸ºå½“å‰è§†å›¾æ¶ˆå¤±å’Œä¸‹ä¸€è§†å›¾å‡ºç°ã€‚

å‚ä¸è½¬åœºåŠ¨ç”»çš„ä¸»è¦æœ‰ä¸€ä¸‹å‡ ä¸ªåè®®:

1. è½¬åœºä»£ç†(Transition Delegate)
2. åŠ¨ç”»æ§åˆ¶å™¨(Animation Controller)
3. äº¤äº’æ§åˆ¶å™¨(Interaction Controller)
4. è½¬åœºç¯å¢ƒ(Transition Context)
5. è½¬åœºåè°ƒå™¨(Transition Coordinator)

å¯¹äº<font color="red">éäº¤äº’å¼åŠ¨ç”»</font> æˆ‘ä»¬åªéœ€è¦å®ç°<font color="red">è½¬åœºä»£ç†åè®®</font>å’Œ<font color="red">åŠ¨ç”»æ§åˆ¶å™¨åè®®</font>å³å¯ã€‚

å¯¹äº<font color="red">äº¤äº’å¼åŠ¨ç”»</font>æˆ‘ä»¬è¿˜éœ€è¦å®ç°<font color="red">äº¤äº’æ§åˆ¶å™¨åè®®</font> ã€‚ğŸ‘‡ä¸‹é¢å¯¹æ¯ä¸ªåè®®è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚

### 1. è½¬åœºä»£ç†ï¼ˆTransition Delegateï¼‰

è‡ªå®šä¹‰è½¬åœºçš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯æä¾›è½¬åœºä»£ç†ï¼Œå‘Šè¯‰ç³»ç»Ÿä½¿ç”¨æˆ‘ä»¬æä¾›çš„ä»£ç†è€Œä¸æ˜¯ç³»ç»Ÿçš„é»˜è®¤ä»£ç†æ¥æ‰§è¡Œè½¬åœºã€‚æ ¹æ®æ§åˆ¶å™¨çš„ä¸åŒï¼Œè‹¹æœç»™æˆ‘ä»¬æä¾›äº†ä¸‰ç§è½¬åœºä»£ç†ï¼š

#### UINavigationControllerDelegate

UINavigationController çš„ delegate å±æ€§éµå®ˆè¯¥åè®®ã€‚

```objectivec
/*è¿”å›å·²ç»å®ç°çš„`åŠ¨ç”»æ§åˆ¶å™¨`ï¼Œå¦‚æœè¿”å›nilåˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„åŠ¨ç”»æ•ˆæœ*/
- (nullable id <UIViewControllerAnimatedTransitioning>)navigationController:(UINavigationController *)navigationController 
animationControllerForOperation:(UINavigationControllerOperation)operation  
fromViewController:(UIViewController *)fromVC 
toViewController:(UIViewController *)toVC  NS_AVAILABLE_IOS(7_0);

/*è¿”å›å·²ç»å®ç°çš„`äº¤äº’æ§åˆ¶å™¨`ï¼Œå¦‚æœè¿”å›nilåˆ™ä¸æ”¯æŒæ‰‹åŠ¿äº¤äº’*/
- (nullable id <UIViewControllerInteractiveTransitioning>)navigationController:(UINavigationController *)navigationController 
interactionControllerForAnimationController:(id <UIViewControllerAnimatedTransitioning>) animationController NS_AVAILABLE_IOS(7_0);
```

#### UITabBarControllerDelegate

åŒæ ·ä½œä¸ºå®¹å™¨æ§åˆ¶å™¨ï¼ŒUITabBarController çš„è½¬åœºä»£ç†å’Œ UINavigationController ç±»ä¼¼ï¼Œé€šè¿‡ç±»ä¼¼çš„æ–¹æ³•æä¾›åŠ¨ç”»æ§åˆ¶å™¨ï¼Œä¸è¿‡UINavigationControllerDelegateçš„ä»£ç†æ–¹æ³•é‡Œæä¾›äº†æ“ä½œç±»å‹ï¼Œä½†UITabBarControllerDelegateçš„ä»£ç†æ–¹æ³•æ²¡æœ‰æä¾›æ»‘åŠ¨çš„æ–¹å‘ä¿¡æ¯ï¼Œéœ€è¦æˆ‘ä»¬æ¥è·å–æ»‘åŠ¨çš„æ–¹å‘ã€‚

```objectivec
/*åŒç†è¿”å›å·²ç»å®ç°çš„`åŠ¨ç”»æ§åˆ¶å™¨`,è¿”å›nilæ˜¯é»˜è®¤æ•ˆæœ*/
- (nullable id <UIViewControllerAnimatedTransitioning>)tabBarController:(UITabBarController *)tabBarController animationControllerForTransitionFromViewController:(UIViewController *)fromVC toViewController:(UIViewController *)toVC;

/*è¿”å›å·²ç»å®ç°çš„`äº¤äº’æ§åˆ¶å™¨`,è¿”å›nilåˆ™ä¸æ”¯æŒç”¨æˆ·äº¤äº’*/
- (nullable id <UIViewControllerInteractiveTransitioning>)tabBarController:(UITabBarController *)tabBarController interactionControllerForAnimationController: (id <UIViewControllerAnimatedTransitioning>)animationController NS_AVAILABLE_IOS(7_0);
```

#### UIViewControllerTransitioningDelegate

Modal è½¬åœºçš„ä»£ç†åè®®UIViewControllerTransitioningDelegateæ˜¯ iOS 7 æ–°å¢çš„ï¼Œå…¶ä¸º presentation å’Œ dismissal è½¬åœºåˆ†åˆ«æä¾›äº†åŠ¨ç”»æ§åˆ¶å™¨ã€‚

UIPresentationControlleråªåœ¨ iOS 8ä¸­å¯ç”¨ï¼Œé€šè¿‡availableå…³é”®å­—å¯ä»¥è§£å†³ API çš„ç‰ˆæœ¬å·®å¼‚ã€‚

Modal è½¬åœºçš„ä»£ç†ç”± presentedVC çš„transitioningDelegateå±æ€§æ¥æä¾›ï¼Œè¿™ä¸å‰ä¸¤ç§å®¹å™¨æ§åˆ¶å™¨çš„è½¬åœºä¸ä¸€æ ·,å¦å¤–ï¼Œéœ€è¦å°† presentedVC çš„modalPresentationStyleå±æ€§è®¾ç½®ä¸º.Customæˆ–.FullScreenï¼Œåªæœ‰è¿™ä¸¤ç§æ¨¡å¼ä¸‹æ‰æ”¯æŒè‡ªå®šä¹‰è½¬åœºï¼Œè¯¥å±æ€§é»˜è®¤å€¼ä¸º.FullScreenã€‚å½“ä¸ UIPresentationController é…åˆæ—¶è¯¥å±æ€§å¿…é¡»ä¸º.Customã€‚

```objectivec
/*presentæ—¶è°ƒç”¨ï¼Œè¿”å›å·²ç»å®ç°çš„`åŠ¨ç”»æ§åˆ¶å™¨`*/
- (nullable id <UIViewControllerAnimatedTransitioning>)animationControllerForPresentedController:(UIViewController *)presented presentingController:(UIViewController *)presenting sourceController:(UIViewController *)source;

/*dissmissæ—¶è°ƒç”¨ï¼Œè¿”å›å·²ç»å®ç°çš„`åŠ¨ç”»æ§åˆ¶å™¨`*/
- (nullable id <UIViewControllerAnimatedTransitioning>)animationControllerForDismissedController:(UIViewController *)dismissed;

/*äº¤äº’åŠ¨ç”»presentæ—¶è°ƒç”¨ï¼Œè¿”å›å·²ç»å®ç°çš„`äº¤äº’æ§åˆ¶å™¨`*/
- (nullable id <UIViewControllerInteractiveTransitioning>)interactionControllerForPresentation:(id <UIViewControllerAnimatedTransitioning>)animator;

/*äº¤äº’åŠ¨ç”»dissmissæ—¶è°ƒç”¨ï¼Œè¿”å›å·²ç»å®ç°çš„`äº¤äº’æ§åˆ¶å™¨`*/
- (nullable id <UIViewControllerInteractiveTransitioning>)interactionControllerForDismissal:(id <UIViewControllerAnimatedTransitioning>)animator;

/*ios8æ–°å¢çš„åè®®*/
- (nullable UIPresentationController *)presentationControllerForPresentedViewController:(UIViewController *)presented presentingViewController:(nullable UIViewController *)presenting sourceViewController:(UIViewController *)source NS_AVAILABLE_IOS(8_0);

```

### 2. åŠ¨ç”»æ§åˆ¶å™¨

åŠ¨ç”»æ§åˆ¶å™¨çš„èŒè´£æ˜¯æ·»åŠ è§†å›¾ä»¥åŠæ‰§è¡ŒåŠ¨ç”»ã€‚

éµå®ˆUIViewControllerAnimatedTransitioningåè®®ï¼Œè¯¥åè®®è¦æ±‚å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š

```objectivec
/*è¿”å›åŠ¨ç”»æ‰§è¡Œæ—¶é—´ï¼Œä¸€èˆ¬0.5så°±è¶³å¤Ÿäº†*/
- (NSTimeInterval)transitionDuration:(nullable id <UIViewControllerContextTransitioning>)transitionContext;

/*æ ¸å¿ƒæ–¹æ³•ï¼Œåšä¸€äº›åŠ¨ç”»ç›¸å…³çš„æ“ä½œ*/
- (void)animateTransition:(id <UIViewControllerContextTransitioning>)transitionContext;
```

UIKit åœ¨è½¬åœºå¼€å§‹å‰ç”Ÿæˆéµå®ˆè½¬åœºç¯å¢ƒåè®®`<UIViewControllerContextTransitioning>`çš„å¯¹è±¡ `transitionContext`ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥æä¾›åŠ¨ç”»æ§åˆ¶å™¨éœ€è¦çš„ä¿¡æ¯ï¼š

```objectivec
/*è·å–å®¹å™¨è§†å›¾ï¼Œè½¬åœºå‘ç”Ÿçš„åœ°æ–¹*/
UIView *containerView = [transitionContext containerView];

/*è·å–å‚ä¸è½¬åœºçš„è§†å›¾æ§åˆ¶å™¨*/
UIViewController *fromVC = [transitionContext viewControllerForKey:UITransitionContextFromViewControllerKey];
UIViewController *toVC = [transitionContext viewControllerForKey:UITransitionContextToViewControllerKey];

/*è·å–å‚ä¸å‚ä¸è½¬åœºçš„è§†å›¾View*/
UIView *fromView;
UIView *toView;
 if ([transitionContext respondsToSelector:@selector(viewForKey:)]) {
      //iOS8æ–°å¢çš„æ–¹æ³•
      fromView = [transitionContext viewForKey:UITransitionContextFromViewKey];
      toView = [transitionContext viewForKey:UITransitionContextToViewKey];
  }else{
      //iOS8ä¹‹å‰çš„æ–¹æ³•
      fromView = fromVC.view;
      toView = toVC.view;
  }

```

UIViewControllerTransitioningDelegate ä»£ç†æ“ä½œä»¥ä¸‹å‡ ä¸ªå¯¹è±¡ï¼š
Animator objects
åŠ¨ç”»å¯¹è±¡

Interactive animator objects
æ‰‹åŠ¿äº¤äº’åŠ¨ç”»å¯¹è±¡
æœ€ç®€å•çš„åˆ›å»ºæ‰‹åŠ¿äº¤äº’åŠ¨ç”»çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ UIPercentDrivenInteractiveTransition

Presentation controller
è¯¥æ§åˆ¶å™¨åªæœ‰åœ¨è§†å›¾æ§åˆ¶å™¨çš„modalPresentationStyle è®¾ç½®æˆ UIModalPresentationCustom æ‰ä¼šä½¿ç”¨ã€‚

å½“ä¸€ä¸ª presented view controller çš„ transitioningDelegate ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œ UIKit ä¼šä½¿ç”¨ä½ æä¾›çš„è‡ªå®šä¹‰åŠ¨ç”»å»å±•ç¤ºæ§åˆ¶å™¨.
å½“è¦å‡†å¤‡å±•ç¤ºçš„æ—¶å€™ï¼ŒUIKit ä¼šè°ƒç”¨ `animationControllerForPresentedController:presentingController:sourceController:` æ–¹æ³•ï¼Œå»æ£€ç´¢è‡ªå®šä¹‰çš„åŠ¨ç”»å¯¹è±¡ã€‚å¦‚æœæ‰€æœ‰çš„å¯¹è±¡éƒ½å‡†å¤‡å¥½äº†ï¼ŒUIKitä¼šæ‰§è¡Œä»¥ä¸‹åŠ¨ä½œï¼š

1. UIKit è°ƒç”¨ `interactionControllerForPresentation:` ä»£ç†æ–¹æ³•å»æŸ¥çœ‹æ˜¯å¦æ‰‹åŠ¿åŠ¨ç”»å¯¹è±¡æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœæ˜¯nil,UIKitæ‰§è¡Œä¸åŒ…å«æ‰‹åŠ¿äº¤äº’çš„åŠ¨ç”»ã€‚

2. UIKit è°ƒç”¨ åŠ¨ç”»å¯¹è±¡çš„`transitionDuration:` æ–¹æ³•æ¥è·å–åŠ¨ç”»æ‰§è¡Œæ—¶é—´ã€‚

3. UIKit é€‰æ‹©åˆé€‚çš„æ–¹æ³•å»å¼€å§‹æ‰§è¡ŒåŠ¨ç”»ï¼š

    * å¯¹æ²¡æœ‰æ‰‹åŠ¿äº¤äº’çš„åŠ¨ç”»ï¼ŒUIKit è°ƒç”¨ `animateTransition:` æ–¹æ³•ã€‚
    * å¯¹äºæ‰‹åŠ¿äº¤äº’åŠ¨ç”»ï¼ŒUIKit è°ƒç”¨ `startInteractiveTransition:` æ–¹æ³•ã€‚

4. UIKit ç­‰å¾…åŠ¨ç”»å¯¹è±¡æ‰§è¡Œå®Œï¼Œè°ƒç”¨ `completeTransition:` æ–¹æ³•ã€‚
å½“åŠ¨ç”»å¯¹è±¡æ‰§è¡Œå®Œï¼ŒUIKitå°±çŸ¥é“åº”è¯¥è°ƒç”¨ `presentViewController:animated:completion:` é‡Œçš„ completion äº†ã€‚ æ¥ç€ï¼Œä¼šè°ƒç”¨ åŠ¨ç”»å¯¹è±¡è‡ªå·±çš„ `animationEnded:` æ–¹æ³•ã€‚

> Calling the completeTransition: method at the end of your animations is required. UIKit does not end the transition process, and thereby return control to your app, until you call that method.


![pic1](https://raw.githubusercontent.com/kakadee/myMarkDownPic/master/img/20190814150042.png)

## å‚è€ƒ

1. [Customizing the Transition Animations](https://developer.apple.com/library/archive/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html#//apple_ref/doc/uid/TP40007457-CH16-SW1)

2. [WXSTransition](https://github.com/alanwangmodify/WXSTransition)

3. [VCTransitionsLibrary](https://github.com/ColinEberhardt/VCTransitionsLibrary)

4. [iOS è§†å›¾æ§åˆ¶å™¨è½¬åœºè¯¦è§£ï¼ˆseedanteï¼‰](https://github.com/seedante/iOS-Note/wiki/ViewController-Transition)

5. [View Controller Programming Guide for iOS
](https://developer.apple.com/library/archive/featuredarticles/ViewControllerPGforiPhoneOS/)

6. [Custom Transitions Using View Controllers
](https://developer.apple.com/videos/play/wwdc2013/218/)
